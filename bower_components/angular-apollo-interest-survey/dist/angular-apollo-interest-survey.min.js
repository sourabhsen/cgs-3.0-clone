!function(e){"use strict";e.module("apolloInterestSurvey.config",[]).value("apolloInterestSurvey.config",{debug:!0,defaultValue:2,pageSize:6,sliderConfig:{from:0,to:4,step:.5},surveyInfo:{id:"holland",name:"mc"}}),e.module("apolloInterestSurvey.directives",["apolloInterestSurvey.directives.interestSurvey"]),e.module("apolloInterestSurvey.filters",["apolloInterestSurvey.filters.startFrom"]),e.module("apolloInterestSurvey.services",[]),e.module("apolloInterestSurvey",["apolloInterestSurvey.config","apolloInterestSurvey.directives","apolloInterestSurvey.filters","apolloInterestSurvey.services"])}(angular),function(){"use strict";angular.module("apolloInterestSurvey.directives.interestSurvey",["apolloInterestSurvey.directive.interestSurvey.vm","apolloInterestSurvey.filters.startFrom","rzModule"]).controller("ApInterestSurveyCtrl",["$scope","InterestSurveyViewModel",function(e,r){e.activate=function(){if(!e.profileId)throw new Error("apInterestSurvey: profileId attribute must be specified!");r.init(e.profileId,e.restart,e.onInit,e.onComplete)},e.vm=r,e.activate()}]).directive("apInterestSurvey",[function(){return{restrict:"E",templateUrl:"angular-apollo-interest-survey/directives/interest-survey.html",controller:"ApInterestSurveyCtrl",scope:{profileId:"=",onComplete:"=",onInit:"=",restart:"="}}}])}(),function(){"use strict";angular.module("apolloInterestSurvey.directive.interestSurvey.vm",["apolloInterestSurvey.config","apolloSurveyServices.survey","apolloSurveyServices.surveyAnswers"]).factory("InterestSurveyViewModel",["$parse","$q","apolloInterestSurvey.config","Survey","SurveyAnswers",function(e,r,t,s,n){var o={retrieved:!1,params:{profileId:null,restart:!1,onComplete:null,onInit:null},surveyQuestions:null,surveyAnswers:{questions:{}},surveyAnswersTransformed:{questions:{}},defaultValue:t.defaultValue,currentPage:0,pageSize:t.pageSize,lastPage:null,sliderConfig:t.sliderConfig,surveyInfo:t.surveyInfo},i={questions:e("data.questions"),scoreByCategory:e("( data.scores | filter : {category: category} )[0].scores"),pctComplete:e('(( data.scores | filter : {category: "answeredQuestionPercentage"} )[0].scores | filter : {scoreName: "percentageAnswered"})[0].scoreValue')};return o.init=function(e,t,u,a){return e?(o.params.profileId=e,o.params.restart=t,o.params.onInit=u,o.params.onComplete=a,o.currentPage=0,s.get({survey:o.surveyInfo.name,id:o.surveyInfo.id}).then(function(e){return o.surveyQuestions=i.questions(e),o.lastPage=(o.surveyQuestions||[]).length/o.pageSize,n.get({profileId:o.params.profileId,survey:o.surveyInfo.name,id:o.surveyInfo.id})}).then(function(e){var r=i.questions(e);r&&e.data.questions&&(angular.forEach(r,function(e){o.surveyAnswers.questions[e.itemId]=e.optionValues&&e.optionValues.length?e.optionValues[0]:e.optionValues}),o.params.restart||(o.currentPage=Math.min(r.length/o.pageSize,o.lastPage-1))),o.retrieved=!0},function(e){return o.surveyQuestions&&o.surveyQuestions.length&&e&&404===e.status?(o.surveyAnswers.questions={},o.retrieved=!0,void 0):r.reject(e)}).finally(function(){o.assignDefaultAnswers(o.currentPage),o.retrieved&&angular.isFunction(o.params.onInit)&&o.params.onInit()})):r.reject("No profileId provided to apInterestSurvey!")},o.saveInterests=function(){return n.save({profileId:o.params.profileId,survey:o.surveyInfo.name,id:o.surveyInfo.id},o.surveyAnswersTransformed)},o.nextGroup=function(){var e=o.surveyAnswers.questions;return o.surveyAnswersTransformed.questions=Object.keys(e).map(function(r){return{itemId:r,optionValues:[e[r].toString()]}}),o.saveInterests().then(function(e){if(o.currentPage+1>=o.lastPage){var t=i.scoreByCategory(e,{category:"adjustedCategoryValueSum"}),s={score:t};if(!t)return r.reject('Survey results not as expected ("adjustedCategoryValueSum" not found)');angular.isFunction(o.params.onComplete)&&o.params.onComplete(s)}else o.currentPage++,o.assignDefaultAnswers(o.currentPage)})},o.previousGroup=function(){o.currentPage=Math.max(o.currentPage-1,0)},o.assignDefaultAnswers=function(e){if(angular.isNumber(e)&&o.surveyQuestions)for(var r=o.surveyQuestions.length,t=e*o.pageSize,s=0;s<o.pageSize&&r>t;s++,t++){var n=o.surveyQuestions[t];o.surveyAnswers.questions[n.itemId]||(o.surveyAnswers.questions[n.itemId]=o.defaultValue)}},o.getSurveyCompleted=function(e){return e?n.get({profileId:e,survey:o.surveyInfo.name,id:o.surveyInfo.id}).then(function(e){var r=parseFloat(i.pctComplete(e)||0);return r},function(e){return e&&404===e.status?0:r.reject(e)}):r.reject("No profileId provided to getSurveyCompleted")},o}])}(),function(){"use strict";angular.module("apolloInterestSurvey.filters.startFrom",[]).filter("startFrom",function(){return function(e,r){return r=+r,e.slice(r)}})}(),angular.module("apolloInterestSurvey.directives").run(["$templateCache",function(e){e.put("angular-apollo-interest-survey/directives/interest-survey.html",'<div class="col survey" ng-if="vm.retrieved"><h4 class="page-title text-center margin-small-bottom no-top-margin">{{vm.currentPage + 1}} of {{vm.surveyQuestions.length/vm.pageSize}}</h4><div class="one-col"><div class="row"><div class="font-small font-heading"><span class="pull-left">Least Interested</span> <span class="pull-right">Most Interested</span></div></div></div><div ng-repeat="question in vm.surveyQuestions | startFrom:vm.currentPage * vm.pageSize | limitTo:vm.pageSize track by $index" class="one-col questions"><div class="row"><div class="question-text">{{question.itemText}}</div><div class="rzsliderContainer"><rzslider class="survey-slider" rz-slider-model="vm.surveyAnswers.questions[question.itemId]" rz-slider-floor="0" rz-slider-ceil="4" rz-slider-step="1" rz-slider-show-ticks="true" rz-slider-hide-limit-labels="true"></rzslider></div></div></div><div class="text-center margin-medium"><button type="button" class="survey-btn survey-btn-prev" tabindex="0" ng-disabled="vm.currentPage === 0" ng-click="vm.previousGroup()"><span class="fa fa-arrow-left"></span></button> <button type="button" class="survey-btn survey-btn-next" tabindex="0" ng-click="saveWait = vm.nextGroup()" cg-busy="{promise: saveWait, profile: \'inlineSmall\'}"><span class="fa fa-arrow-right"></span></button></div></div>')}]);